# SPDX-FileCopyrightText: Â© 2021 ChiselStrike <info@chiselstrike.com>

# RUN: sh -e @file

cat << EOF > "$TEMPDIR/endpoints/pad.js"
type AuthorT = {
    id: number;
    name: string;
    other: number;
};
const authors = Chisel.api.table<AuthorT>("authors", ["id", "name", "other"]);

export default async function chisel(req: Request) {
    const query = await Chisel.query(authors);
    return new Response(query);
}
EOF

cd "$TEMPDIR"
$CHISEL apply

# CHECK: End point defined: /pad

$CURL -o - $CHISELD_HOST/pad

# CHECK: HTTP/1.1 200 OK
# CHECK: SELECT id,name,other FROM authors
