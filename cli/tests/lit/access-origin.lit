# SPDX-FileCopyrightText: Â© 2021 ChiselStrike <info@chiselstrike.com>

# RUN: CURL="@curl" sh -e @file

cat << EOF | $CHISEL end-point create foo -
export default async function chisel(req) {
    return new Response("foo");
}
EOF

# CHECK: End point defined: /foo

$CURL -o - $CHISELD_HOST/foo

# CHECK: HTTP/1.1 200 OK
# CHECK: access-control-allow-origin: *
# CHECK: foo

echo

cat << EOF | $CHISEL end-point create bar -
export default async function chisel(req) {
    return new Response("bar", {
        headers: [
            ["access-control-allow-origin", "https://chiselstrike.com"]
        ]
    });
}
EOF

# CHECK: End point defined: /bar

$CURL -o - $CHISELD_HOST/bar

# CHECK: HTTP/1.1 200 OK
# CHECK: access-control-allow-origin: https://chiselstrike.com
# CHECK: bar
