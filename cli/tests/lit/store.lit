# SPDX-FileCopyrightText: Â© 2021 ChiselStrike <info@chiselstrike.com>

# RUN: CHISEL="@chisel" CURL="@curl" sh -e @file

echo 'type Foo { a: String, b: String }' | $CHISEL type import -

# CHECK: Type defined: Foo

cat << EOF | $CHISEL end-point create ins -
export default async function chisel(req) {
    if (req.method == 'POST') {
        const payload = await req.json();
        await Chisel.store('Foo', payload);
        return new Response('ok\n');
    }
    return new Response('ignored\n');
}
EOF

# CHECK: End point defined: /ins

$CURL --data '{"a":"aaa", "b":"bbb"}' -o - localhost:3000/ins

# CHECK: ok
