# SPDX-FileCopyrightText: Â© 2022 ChiselStrike <info@chiselstrike.com>

# RUN: sh -e @file

cat << EOF > "$TEMPDIR/models/post.ts"
import { ChiselEntity } from "@chiselstrike/chiselstrike";
export class Post extends ChiselEntity {
    author: OAuthUser;
}
EOF

cat << EOF > "$TEMPDIR/endpoints/newuser.js"
import { Post } from '../models/post.ts';
export default async function (req: Request) {
    await Post.build( {author: {username: ''} } ).save();
    return new Response('Successful save!');
}
EOF

cd "$TEMPDIR"
$CHISEL apply

$CURL -X POST $CHISELD_HOST/dev/newuser
# CHECK: Cannot save into type OAuthUser
